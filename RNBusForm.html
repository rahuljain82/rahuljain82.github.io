<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bus Booking - Running Ninjas</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9WH7YSXZ94"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9WH7YSXZ94');
  </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 py-10">
  <div class="w-full flex justify-center mb-6">
    <img src="https://i.ibb.co/ZRLT8bH9/Whats-App-Image-2025-07-16-at-17-29-51.jpg" alt="Running Ninjas Logo" class="w-16 h-16 rounded-full" />
  </div>

  <div class="max-w-md mx-auto bg-white rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Ninja Discount & Bus Interest</h2>

    <form id="busBookingForm">
      <label class="block mb-3">Select Marathon
        <select id="marathonName" required class="w-full mt-1 p-2 border rounded"></select>
      </label>

      <label class="block mb-2">Enter Unique ID
        <input id="uniqueId" name="uniqueId" type="text" required class="w-full mt-1 p-2 border rounded" />
      </label>

      <button type="button" onclick="fetchDetails()" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded mb-4">Show next steps</button>

      <div id="runnerDetails" class="hidden">
        <p class="mb-2"></strong>Your Name:</strong> <span id="name"></span></p>
        <p class="mb-2"></strong>Your Flat No.:</strong> <span id="flat"></span></p>
        <p class="mb-2"><strong>Discounted Ninja Registration Cost to pay:</strong> ₹<span id="ninjadiscountprice"></span></p>
        <p class="mb-2"><strong>Seat Cost to pay:</strong> ₹<span id="seatCost"></span></p>
        <p class="mb-2"><strong>Pay to UPI ID:</strong> <span id="upiId"></span></p>
        <p class="mb-2"><strong>Seats Left:</strong> <span id="seatsLeft"></span></p>
        <p class="mb-2"></strong>Instructions:</strong> <span id="instructions"></span></p>

        <label class="block mb-2">
  Interested in bus booking?
  <select id="businterest" name="businterest" required class="w-full mt-1 p-2 border rounded">
    <option value="">-- Select --</option>
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>
</label>
        
        <label class="block mb-2 mt-4"><strong>Enter Transaction ID
          <input id="transactionId" name="transactionId" type="text" required class="w-full mt-1 p-2 border rounded" />
        </label>

        <button type="submit" class="w-full bg-green-600 text-white font-semibold py-2 rounded mt-2">Count me In</button>
      </div>
    </form>

    <p id="formMessage" class="text-green-600 mt-4 hidden">Entry successful!</p>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwea_Lm7I2QpeEoZ-Jup8DdSDjB-8BhdMgeE55BZIEiKH5pBsYy3_rfI4SqO54xra9F/exec';

    // Load marathon options on page load
    window.onload = async function () {
      const res = await fetch(`${scriptURL}?listMarathons=true`);
      const data = await res.json();
      const dropdown = document.getElementById("marathonName");

      data.marathons.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        dropdown.appendChild(opt);
      });
    };

    async function fetchDetails() {
      const uniqueId = document.getElementById("uniqueId").value.trim();
      const marathonName = document.getElementById("marathonName").value;
      if (!uniqueId || !marathonName) return alert("Please fill both fields.");

      const res = await fetch(`${scriptURL}?uniqueId=${uniqueId}&marathonName=${encodeURIComponent(marathonName)}`);
      const data = await res.json();

      if (!data.success) return alert(data.error || "Runner not found.");

      document.getElementById("name").textContent = data.runner.name;
      document.getElementById("flat").textContent = data.runner.flat;
      document.getElementById("ninjadiscountprice").textContent = data.event.ninjaPrice;
      document.getElementById("seatCost").textContent = data.event.seatCost;
      document.getElementById("upiId").textContent = data.event.upiId;
      document.getElementById("seatsLeft").textContent = data.event.seatsLeft;
      document.getElementById("instructions").textContent = data.event.instructions;

      document.getElementById("runnerDetails").classList.remove("hidden");
    }

    document.getElementById("busBookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formMessage = document.getElementById("formMessage");

      const formData = new FormData();
      formData.append("uniqueId", document.getElementById("uniqueId").value);
      formData.append("marathonName", document.getElementById("marathonName").value);
      formData.append("name", document.getElementById("name").textContent);
      formData.append("flat", document.getElementById("flat").textContent);
      formData.append("transactionId", document.getElementById("transactionId").value.trim());
      formData.append("businterest", document.getElementById("businterest").value.trim());

      const res = await fetch(scriptURL, {
        method: 'POST',
        body: formData
      });

      const responseText = await res.text();

      if (responseText.includes("Success")) {
        formMessage.classList.remove("hidden");
        document.getElementById("busBookingForm").reset();
        document.getElementById("runnerDetails").classList.add("hidden");
      } else {
        alert("Error: " + responseText);
      }
    });
  </script>
</body>
</html>
