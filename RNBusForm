<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bus Booking - Running Ninjas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 py-10">
  <div class="w-full flex justify-center mb-6">
    <img src="https://i.ibb.co/ZRLT8bH9/Whats-App-Image-2025-07-16-at-17-29-51.jpg" alt="Running Ninjas Logo" class="w-16 h-16 rounded-full" />
  </div>

  <div class="max-w-md mx-auto bg-white rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Marathon Bus Booking</h2>
    <form id="busBookingForm">
      <label class="block mb-2">Enter Unique ID
        <input id="uniqueId" name="uniqueId" type="text" required class="w-full mt-1 p-2 border rounded" />
      </label>
      <button type="button" onclick="fetchDetails()" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded mb-4">Fetch My Details</button>

      <div id="runnerDetails" class="hidden">
        <p class="mb-2"><strong>Name:</strong> <span id="name"></span></p>
        <p class="mb-2"><strong>Flat No.:</strong> <span id="flat"></span></p>
        <p class="mb-2"><strong>Seat Cost:</strong> <span id="seatCost"></span></p>
        <p class="mb-2"><strong>UPI ID:</strong> <span id="upiId"></span></p>
        <p class="mb-2"><strong>Seats Left:</strong> <span id="seatsLeft"></span></p>
        <p class="mb-2"><strong>Instructions:</strong> <span id="instructions"></span></p>

        <button type="submit" class="w-full bg-green-600 text-white font-semibold py-2 rounded">Confirm My Seat</button>
      </div>
    </form>
    <p id="formMessage" class="text-green-600 mt-4 hidden">Seat booking successful!</p>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwea_Lm7I2QpeEoZ-Jup8DdSDjB-8BhdMgeE55BZIEiKH5pBsYy3_rfI4SqO54xra9F/exec';

    async function fetchDetails() {
      const uniqueId = document.getElementById("uniqueId").value.trim();
      if (!uniqueId) return alert("Please enter a Unique ID.");

      const res = await fetch(`${scriptURL}?uniqueId=${uniqueId}`);
      const data = await res.json();

      if (!data.success) return alert("Runner not found.");

      document.getElementById("name").textContent = data.runner.name;
      document.getElementById("flat").textContent = data.runner.flat;
      document.getElementById("seatCost").textContent = `â‚¹${data.event.seatCost}`;
      document.getElementById("upiId").textContent = data.event.upiId;
      document.getElementById("seatsLeft").textContent = data.event.seatsLeft;
      document.getElementById("instructions").textContent = data.event.instructions;

      document.getElementById("runnerDetails").classList.remove("hidden");
    }

    document.getElementById("busBookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formMessage = document.getElementById("formMessage");
      const formData = new FormData();

      formData.append("uniqueId", document.getElementById("uniqueId").value);
      formData.append("name", document.getElementById("name").textContent);
      formData.append("flat", document.getElementById("flat").textContent);

      const res = await fetch(scriptURL, {
        method: 'POST',
        body: formData
      });
      const responseText = await res.text();

      if (responseText.includes("Success")) {
        formMessage.classList.remove("hidden");
        document.getElementById("busBookingForm").reset();
        document.getElementById("runnerDetails").classList.add("hidden");
      } else {
        alert("Error: " + responseText);
      }
    });
  </script>
</body>
</html>
