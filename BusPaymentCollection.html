<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bus Booking - Running Ninjas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 py-10">
  <div class="w-full flex justify-center mb-6">
    <img src="https://i.ibb.co/ZRLT8bH9/Whats-App-Image-2025-07-16-at-17-29-51.jpg" alt="Running Ninjas Logo" class="w-16 h-16 rounded-full" />
  </div>

  <div class="max-w-md mx-auto bg-white rounded-xl shadow p-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Bus Payment</h2>

    <form id="busBookingForm">
      <label class="block mb-3">Enter Marathon Name
        <input id="marathonName" type="text" required class="w-full mt-1 p-2 border rounded"/>
      </label>

      <label class="block mb-2">Enter Unique ID
        <input id="uniqueId" name="uniqueId" type="text" required class="w-full mt-1 p-2 border rounded" />
      </label>

      <button type="button" onclick="checkEligibility()" class="w-full bg-indigo-600 text-white font-semibold py-2 rounded mb-4">Check my bus allocation</button>
      <p id="eligibilityMessage" class="text-blue-600 mb-4"></p>


<!--       <div id="runnerDetails" class="hidden">
        <p class="mb-2"></strong>Your Name:</strong> <span id="name"></span></p>
        <p class="mb-2"></strong>Your Flat No.:</strong> <span id="flat"></span></p>
        <p class="mb-2"><strong>Discounted Ninja Registration Cost to pay:</strong> ₹<span id="ninjadiscountprice"></span></p>
        <p class="mb-2"><strong>Seat Cost to pay:</strong> ₹<span id="seatCost"></span></p>
        <p class="mb-2"><strong>Pay to UPI ID:</strong> <span id="upiId"></span></p>
        <p class="mb-2"><strong>Seats Left:</strong> <span id="seatsLeft"></span></p>
        <p class="mb-2"></strong>Instructions:</strong> <span id="instructions"></span></p> -->

<!--         <label class="block mb-2">
  Interested in bus booking?
  <select id="businterest" name="businterest" required class="w-full mt-1 p-2 border rounded">
    <option value="">-- Select --</option>
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>
</label> -->

<div id="busPaymentSection" class="hidden">
  <label class="block mb-2 mt-4"><strong>Enter Bus Payment ID
    <input id="transactionId" name="transactionId" type="text" required class="w-full mt-1 p-2 border rounded" />
  </label>
  <button type="button" onclick="submitBusPayment()" class="w-full bg-green-600 text-white font-semibold py-2 rounded mt-2">
    Submit Bus Payment
  </button>
</div>

      
<!--         <label class="block mb-2 mt-4"><strong>Enter Bus Payment ID
          <input id="transactionId" name="transactionId" type="text" required class="w-full mt-1 p-2 border rounded" />
        </label>

        <button type="submit" class="w-full bg-green-600 text-white font-semibold py-2 rounded mt-2">Submit Payment details</button> -->
      </div>
    </form>

    <p id="formMessage" class="text-green-600 mt-4 hidden">Entry successful!</p>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwYNRhRy8dbhwOUs3YW0o2fukvwjlakaQ9-WYuNqYot5cbccU_F0oPa598mkfZ62N9czg/exec';

    

    // // Load marathon options on page load
    // window.onload = async function () {
    //   const res = await fetch(`${scriptURL}?listMarathons=true`);
    //   const data = await res.json();
    //   const dropdown = document.getElementById("marathonName");

    //   data.marathons.forEach(name => {
    //     const opt = document.createElement("option");
    //     opt.value = name;
    //     opt.textContent = name;
    //     dropdown.appendChild(opt);
    //   });
    // };

      async function checkEligibility() {
      const uniqueId = document.getElementById("uniqueId").value.trim();
      const marathonName = document.getElementById("marathonName").value.trim();
      if (!uniqueId || !marathonName) {
        alert("Please fill in both fields.");
        return;
      }

      const res = await fetch(`${scriptURL}?action=check&uniqueId=${encodeURIComponent(uniqueId)}&marathonName=${encodeURIComponent(marathonName)}`);
      const data = await res.json();

      if (data.allowed) {
        document.getElementById("eligibilityMessage").textContent = "You are eligible to submit bus payment.";
        document.getElementById("busPaymentSection").classList.remove("hidden");
      } else {
        document.getElementById("eligibilityMessage").textContent = data.reason || "Not eligible.";
        document.getElementById("busPaymentSection").classList.add("hidden");
      }
    }

    async function submitBusPayment() {
      const uniqueId = document.getElementById("uniqueId").value.trim();
      const marathonName = document.getElementById("marathonName").value.trim();
      const busTransactionId = document.getElementById("transactionId").value.trim();
      if (!busTransactionId) {
        alert("Please enter bus transaction ID.");
        return;
      }

      const res = await fetch(`${scriptURL}?action=record&uniqueId=${encodeURIComponent(uniqueId)}&marathonName=${encodeURIComponent(marathonName)}&busTransactionId=${encodeURIComponent(busTransactionId)}`);
      const data = await res.json();

      if (data.success) {
        alert("Bus payment recorded successfully.");
        document.getElementById("busPaymentSection").classList.add("hidden");
      } else {
        alert(data.error || "Failed to record payment.");
      }
    }
 
    // async function fetchDetails() {
    //   const uniqueId = document.getElementById("uniqueId").value.trim();
    //   const marathonName = document.getElementById("marathonName").value;
    //   if (!uniqueId || !marathonName) return alert("Please fill both fields.");

    //   const res = await fetch(`${scriptURL}?uniqueId=${uniqueId}&marathonName=${encodeURIComponent(marathonName)}`);
    //   const data = await res.json();

    //   if (!data.success) return alert(data.error || "Runner not found.");

    //   document.getElementById("name").textContent = data.runner.name;
    //   document.getElementById("flat").textContent = data.runner.flat;
    //   document.getElementById("ninjadiscountprice").textContent = data.event.ninjaPrice;
    //   document.getElementById("seatCost").textContent = data.event.seatCost;
    //   document.getElementById("upiId").textContent = data.event.upiId;
    //   document.getElementById("seatsLeft").textContent = data.event.seatsLeft;
    //   document.getElementById("instructions").textContent = data.event.instructions;

    //   document.getElementById("runnerDetails").classList.remove("hidden");
    // }

    // document.getElementById("busBookingForm").addEventListener("submit", async (e) => {
    //   e.preventDefault();
    //   const formMessage = document.getElementById("formMessage");

    //   const formData = new FormData();
    //   formData.append("uniqueId", document.getElementById("uniqueId").value);
    //   formData.append("marathonName", document.getElementById("marathonName").value);
    //   formData.append("name", document.getElementById("name").textContent);
    //   formData.append("flat", document.getElementById("flat").textContent);
    //   formData.append("transactionId", document.getElementById("transactionId").value.trim());
    //   formData.append("businterest", document.getElementById("businterest").value.trim());

    //   const res = await fetch(scriptURL, {
    //     method: 'POST',
    //     body: formData
    //   });

    //   const responseText = await res.text();

    //   if (responseText.includes("Success")) {
    //     formMessage.classList.remove("hidden");
    //     document.getElementById("busBookingForm").reset();
    //     document.getElementById("runnerDetails").classList.add("hidden");
    //   } else {
    //     alert("Error: " + responseText);
    //   }
    // });
  </script>
</body>
</html>




<!-- <!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bus Payment Form</title>
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwYNRhRy8dbhwOUs3YW0o2fukvwjlakaQ9-WYuNqYot5cbccU_F0oPa598mkfZ62N9czg/exec"; // Replace with deployed script URL

    async function checkEligibility() {
      const uniqueId = document.getElementById("uniqueId").value.trim();
      const marathonName = document.getElementById("marathonName").value.trim();
      if (!uniqueId || !marathonName) {
        alert("Please fill in both fields.");
        return;
      }

      const res = await fetch(`${scriptURL}?action=check&uniqueId=${encodeURIComponent(uniqueId)}&marathonName=${encodeURIComponent(marathonName)}`);
      const data = await res.json();

      if (data.allowed) {
        document.getElementById("eligibilityMessage").textContent = "You are eligible to submit bus payment.";
        document.getElementById("busPaymentSection").classList.remove("hidden");
      } else {
        document.getElementById("eligibilityMessage").textContent = data.reason || "Not eligible.";
        document.getElementById("busPaymentSection").classList.add("hidden");
      }
    }

    async function submitBusPayment() {
      const uniqueId = document.getElementById("uniqueId").value.trim();
      const marathonName = document.getElementById("marathonName").value.trim();
      const busTransactionId = document.getElementById("transactionId").value.trim();
      if (!busTransactionId) {
        alert("Please enter bus transaction ID.");
        return;
      }

      const res = await fetch(`${scriptURL}?action=record&uniqueId=${encodeURIComponent(uniqueId)}&marathonName=${encodeURIComponent(marathonName)}&busTransactionId=${encodeURIComponent(busTransactionId)}`);
      const data = await res.json();

      if (data.success) {
        alert("Bus payment recorded successfully.");
        document.getElementById("busPaymentSection").classList.add("hidden");
      } else {
        alert(data.error || "Failed to record payment.");
      }
    }
  </script>
  <style>
    .hidden { display: none; }
    body { font-family: Arial, sans-serif; margin: 2rem; }
    input, button { padding: 0.5rem; margin: 0.25rem 0; }
  </style>
</head>
<body>
  <h2>Bus Payment Form</h2>
  <label>Unique ID:<br>
    <input type="text" id="uniqueId">
  </label><br>
  <label>Marathon Name:<br>
    <input type="text" id="marathonName">
  </label><br>
  <button onclick="checkEligibility()">Check Eligibility</button>
  <p id="eligibilityMessage"></p>

  <div id="busPaymentSection" class="hidden">
    <label>Bus Payment Transaction ID:<br>
      <input type="text" id="busTransactionId">
    </label><br>
    <button onclick="submitBusPayment()">Submit Bus Payment</button>
  </div>
</body>
</html>
 -->
